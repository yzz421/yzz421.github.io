"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[862],{39143:function(N,g,e){e.d(g,{p:function(){return h}});var K=e(15009),R=e.n(K),x=e(19632),P=e.n(x),W=e(99289),L=e.n(W),U=e(5574),F=e.n(U),w=e(97857),m=e.n(w),S=e(3253),E=e(184),A=e(97269),c=e(5966),Y=e(50727),j=e(31199),Z=e(80854),C=e(23323),$=e(68872),G=e(14726),B=e(27484),M=e.n(B),a=e(96486),V=e.n(a),y=e(67294),t=e(85893),h=function(){var z=arguments.length>0&&arguments[0]!==void 0?arguments[0]:100;return new Promise(function(l){setTimeout(function(){l(!0)},z)})};g.Z=function(){var r=(0,Z.useModel)("global"),z=r.kucunmingxi,l=r.setkucunmingxi,s=r.kucun,b=r.setkucun,v=M()().format("YYYYMMDD"),H=[{dataIndex:"name",title:"\u54C1\u540D",formItemProps:{required:!0,rules:[{required:!0}]},valueEnum:{\u767D\u7BA1:{text:"\u767D\u7BA1"},\u77ED\u5C3E:{text:"\u77ED\u5C3E"},\u82B1\u80A0\u5934:{text:"\u82B1\u80A0\u5934"},\u957F\u5C3E:{text:"\u957F\u5C3E"}}},{dataIndex:"batch",title:"\u6279\u6B21",fieldProps:{disabled:!0}},{dataIndex:"mode",title:"\u5E93\u5B58\u65B9\u5F0F",formItemProps:{required:!0,rules:[{required:!0}]},valueType:"select",valueEnum:{"\u6025\u51BB+\u51B7\u5B58":{text:"\u6025\u51BB+\u51B7\u5B58"}}},{dataIndex:"shed",title:"\u5B58\u653E\u5E93\u4F4D",width:100,formItemProps:{required:!0,rules:[{required:!0}]}},{dataIndex:"quantity",title:"\u6570\u91CF",valueType:"digit",fieldProps:function(f,o){var d=o.rowIndex;return{onChange:function(){var n,i,D,u=(n=T.current)===null||n===void 0?void 0:n.getRowData(d);(i=T.current)===null||i===void 0||(D=i.setRowData)===null||D===void 0||D.call(i,d,m()(m()({},u),{},{weight:u.quantity&&u.norms?u.quantity*u.norms:0}))}}},formItemProps:{required:!0,rules:[{required:!0}]}},{dataIndex:"norms",title:"\u89C4\u683C",valueType:"digit",fieldProps:function(f,o){var d=o.rowIndex;return{onChange:function(){var n,i,D,u=(n=T.current)===null||n===void 0?void 0:n.getRowData(d);(i=T.current)===null||i===void 0||(D=i.setRowData)===null||D===void 0||D.call(i,d,m()(m()({},u),{},{weight:u.quantity&&u.norms?u.quantity*u.norms:0}))}}},formItemProps:{required:!0,rules:[{required:!0}]}},{dataIndex:"weight",title:"\u91CD\u91CF\uFF08KG\uFF09",valueType:"digit",formItemProps:{required:!0,rules:[{required:!0}]}},{dataIndex:"desc",title:"\u5907\u6CE8"}],J=C.Z.useForm(),Q=F()(J,1),I=Q[0],X=function(){var O=L()(R()().mark(function f(){var o,d,_,n,i;return R()().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return u.next=2,I.validateFields();case 2:return _=I.getFieldsValue(),n=(0,a.map)(_==null?void 0:_.details,function(p){return m()(m()({customer:_==null?void 0:_.customer,batch:v},p),{},{days:1})}),i={bizId:_==null?void 0:_.bizId,shed:"1",customer:_==null?void 0:_.customer,bizOwner:_==null?void 0:_.bizOwner,batch:v,quantity:(0,a.sum)(_==null||(o=_.details)===null||o===void 0?void 0:o.map(function(p){return(0,a.toNumber)(p.quantity)})),weight:(0,a.sum)(_==null||(d=_.details)===null||d===void 0?void 0:d.map(function(p){return(0,a.toNumber)(p.weight)})),norms:10,name:(0,a.map)(_==null?void 0:_.details,function(p){return p.name}).join("\u3001"),desc:_==null?void 0:_.desc,details:n,bizType:"\u5165\u5E93",bizDate:M()().format("YYYY-MM-DD"),days:1},l([].concat(P()(z),[i])),b([].concat(P()(s),P()(n))),u.next=9,h(1e3);case 9:return $.ZP.success("\u5165\u5E93\u6210\u529F"),I.resetFields(),u.abrupt("return",!0);case 12:case"end":return u.stop()}},f)}));return function(){return O.apply(this,arguments)}}(),T=(0,y.useRef)();return(0,t.jsxs)(E.a,{initialValues:{bizId:"R"+M()().format("YYYYMMDD")+"001",batch:v,bizDate:M()().format("YYYY-MM-DD")},form:I,width:"90%",submitter:{render:function(f,o){return P()(o)}},drawerProps:{destroyOnClose:!0},onFinish:X,trigger:(0,t.jsxs)(G.ZP,{type:"primary",children:[(0,t.jsx)(S.Z,{}),"\u65B0\u5EFA\u5165\u5E93\u5355"]}),title:"\u65B0\u5EFA\u5165\u5E93\u5355",children:[(0,t.jsx)(A.A.Group,{children:(0,t.jsx)(c.Z,{label:"\u5165\u5E93\u5355\u53F7",name:"bizId",disabled:!0,width:"md"})}),(0,t.jsxs)(A.A.Group,{children:[(0,t.jsx)(c.Z,{name:"batch",hidden:!0,label:"\u6279\u6B21",width:"md"}),(0,t.jsx)(c.Z,{name:"customer",required:!0,rules:[{required:!0}],label:"\u51FA\u8D27\u5355\u4F4D/\u5BA2\u6237",width:"md"}),(0,t.jsx)(c.Z,{name:"bizOwner",required:!0,rules:[{required:!0}],label:"\u5236\u5355\u4EBA",width:"md"}),(0,t.jsx)(c.Z,{name:"bizDate",required:!0,rules:[{required:!0}],disabled:!0,label:"\u5165\u5E93\u65F6\u95F4",width:"md"}),(0,t.jsx)(c.Z,{name:"desc",label:"\u5907\u6CE8",width:"md"})]}),(0,t.jsx)(Y.Z,{editableFormRef:T,name:"details",rowKey:"id",recordCreatorProps:{newRecordType:"dataSource",record:function(){return{id:Date.now(),batch:v}}},editable:{type:"multiple",actionRender:function(f,o,d){return[d.delete]},onValuesChange:function(f,o){var d=(0,a.sum)((0,a.map)(o,function(n){return n.quantity||0})),_=(0,a.sum)((0,a.map)(o,function(n){return n.weight||0}));I.setFieldValue("quantity",d),I.setFieldValue("weight",_)}},columns:H}),(0,t.jsxs)(A.A.Group,{children:[(0,t.jsx)(j.Z,{placeholder:"",name:"quantity",disabled:!0,label:"\u603B\u6570\u91CF"}),(0,t.jsx)(j.Z,{placeholder:"",name:"weight",disabled:!0,label:"\u603B\u91CD\u91CF\uFF08KG\uFF09"})]})]})}},20013:function(N,g,e){e.r(g);var K=e(15009),R=e.n(K),x=e(97857),P=e.n(x),W=e(99289),L=e.n(W),U=e(5574),F=e.n(U),w=e(90930),m=e(49838),S=e(80854),E=e(96486),A=e.n(E),c=e(67294),Y=e(39143),j=e(85893);g.default=function(){var Z=(0,S.useModel)("global"),C=Z.kucun,$=E.sum(C.map(function(y){return y.weight})),G=(0,c.useState)(!1),B=F()(G,2),M=B[0],a=B[1],V=[{dataIndex:"shed",title:"\u5E93\u623F",hideInSearch:!0},{dataIndex:"name",title:"\u54C1\u7C7B"},{dataIndex:"batch",hideInTable:!M,title:"\u5E93\u5B58\u6279\u6B21"},{dataIndex:"days",hideInTable:!M,title:"\u5929\u6570",hideInSearch:!0},{dataIndex:"quantity",title:"\u6570\u91CF",hideInSearch:!0},{dataIndex:"norms",title:"\u89C4\u683C",hideInSearch:!0},{dataIndex:"weight",title:"\u91CD\u91CF\uFF08KG\uFF09",hideInSearch:!0},{dataIndex:"customer",title:"\u5BA2\u6237"}];return console.log("kucun",C),(0,j.jsx)(w._z,{title:"\u5E93\u5B58\u603B\u89C8",children:(0,j.jsx)(m.Z,{request:function(){var y=L()(R()().mark(function t(h){var r;return R()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return a(!!h.batch),l.next=3,(0,Y.p)(300);case 3:return r=C,h.name&&(r=r.filter(function(s){return s.name.includes(h.name)})),h.batch?r=r.filter(function(s){var b;return(b=s.batch)===null||b===void 0?void 0:b.includes(h.batch)}):r=E.map(E.groupBy(r,"name"),function(s){return s.length==1?E.get(s,[0]):E.reduce(s,function(b,v){return P()(P()({},v),{},{quantity:b.quantity||0+v.quantity,weight:b.weight||0+v.weight})},{})}),l.abrupt("return",{data:r,success:!0,total:r.length});case 7:case"end":return l.stop()}},t)}));return function(t){return y.apply(this,arguments)}}(),headerTitle:"\u5E93\u5B58\u603B\u91CD\u91CF\uFF1A".concat($," KG"),columns:V})})}}}]);
